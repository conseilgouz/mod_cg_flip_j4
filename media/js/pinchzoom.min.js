/***
 * @package CG Flip Module
 * @version 2.4.10
 * @license https://www.gnu.org/licenses/gpl-3.0.html GNU/GPL
 * @copyright (c) 2024 ConseilGouz. All Rights Reserved.
 * @author ConseilGouz 
 * pinch zoom from https://github.com/anitasv/zoom
 **/
var scmult=function(t,e){return[t*e[0],t*e[1]]},vcadd=function(t,e){return[t[0]+e[0],t[1]+e[1]]},minus=function(t,e){return[t[0]-e[0],t[1]-e[1]]},dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},wedge=function(t,e){return t[0]*e[1]-t[1]*e[0]},apply=function(t,e){return vcadd(scmult(e[0],t[0]),scmult(e[1],t[1]))},mult=function(t,e){return[apply(t,e[0]),apply(t,e[1])]};function Transform(t,e){this.A=t,this.b=e}Transform.prototype.css=function(){var t=this.A,e=this.b;return"matrix("+t[0][0]+","+t[0][1]+","+t[1][0]+","+t[1][1]+","+e[0]+","+e[1]+")"};var cascade=function(t,e){return new Transform(mult(t.A,e.A),vcadd(apply(t.A,e.b),t.b))},rotate=function(t,e){return[[t,e],[-e,t]]},rotscale=function(t,e){var n=dot(t,t),o=dot(t,e),i=wedge(t,e);return rotate(o/n,i/n)},justscale=function(t,e){var n=Math.sqrt(dot(t,t)),o=Math.sqrt(dot(e,e));return rotate(o/n,0)},magnification=function(t){return Math.abs((t[0][0]+t[1][1])/2)},scaleMatrix=function(t,e){return[scmult(e,t[0]),scmult(e,t[1])]},zoom=function(t,e,n,o,i){var r=minus(t[1],t[0]),a=minus(e[1],e[0]),s=n?rotscale(r,a):justscale(r,a),u=magnification(s);u<o?s=scaleMatrix(s,o/u):u>i&&(s=scaleMatrix(s,i/u));var m=apply(s,t[0]);return new Transform(s,minus(e[0],m))},avgVector=function(t,e,n){var o=scmult(1-n,t),i=scmult(n,e);return vcadd(o,i)},avgMatrix=function(t,e,n){return[avgVector(t[0],e[0],n),avgVector(t[1],e[1],n)]};Transform.avg=function(t,e,n){return new Transform(avgMatrix(t.A,e.A,n),avgVector(t.b,e.b,n))};var identity=new Transform([[1,0],[0,1]],[0,0]),defaults=function(t,e){return void 0===t?e:t},default_config=function(t,e){var n=defaults(t,{});for(var o in e)n[o]=defaults(n[o],e[o]);return n};function Zoom(t,e,n){this.mayBeDoubleTap=null,this.isAnimationRunning=!1,this.curTouch=0,this.elem=t,this.elemParent=t.parentNode,this.activeZoom=identity,this.resultantZoom=identity,this.srcCoords=[0,0],this.destCoords=[0,0];var o=this;this.config=default_config(e,{pan:!1,rotate:!0,minZoom:0,maxZoom:1/0}),this.wnd=n||window,t.style["will-change"]="transform",t.style["transform-origin"]="0 0";var i=function(e){return e.length>1?function(e){var n=t.parentNode.getBoundingClientRect(),o=window.scrollX+n.left,i=window.scrollY+n.top;return[[e[0].pageX-o,e[0].pageY-i],[e[1].pageX-o,e[1].pageY-i]]}(e):function(e){var n=t.parentNode.getBoundingClientRect(),o=n.left,i=n.top,r=e[0].pageX-o,a=e[0].pageY-i;return[[r,a],[r+1,a+1]]}(e)},r=function(t){return function(e){if(e.preventDefault(),o.isAnimationRunning)return!1;var n=e.touches;if(!n)return!1;t(n)}};this._handleZoom=r(function(t){var e=t.length;1==e&&o.activeZoom==identity||(e!==o.curTouch?(o.curTouch=e,o.finalize(),0!==e&&function(t){o.srcCoords=i(t),o.destCoords=o.srcCoords}(t)):(!function(t){o.destCoords=i(t)}(t),o.previewZoom()))}),this._handleTouchStart=r(function(t){1===t.length&&(null!==o.mayBeDoubleTap?(o.wnd.clearTimeout(o.mayBeDoubleTap),o.reset(),o.mayBeDoubleTap=null):o.mayBeDoubleTap=o.wnd.setTimeout(function(){o.mayBeDoubleTap=null},300))}),this.elemParent.addEventListener("touchstart",this._handleTouchStart),this.elemParent.addEventListener("touchstart",this._handleZoom),this.elemParent.addEventListener("touchmove",this._handleZoom),this.elemParent.addEventListener("touchend",this._handleZoom)}Zoom.prototype.destroy=function(){this.elemParent.removeEventListener("touchstart",this._handleTouchStart),this.elemParent.removeEventListener("touchstart",this._handleZoom),this.elemParent.removeEventListener("touchmove",this._handleZoom),this.elemParent.removeEventListener("touchend",this._handleZoom),this.elem.style["will-change"]=null,this.elem.style["transform-origin"]=null,this.elem.style.transform=null},Zoom.prototype.previewZoom=function(){var t=magnification(this.activeZoom.A),e=this.config.minZoom/t,n=this.config.maxZoom/t,o=zoom(this.srcCoords,this.destCoords,this.config.rotate,e,n);this.resultantZoom=cascade(o,this.activeZoom),this.repaint()},Zoom.prototype.setZoom=function(t){this.resultantZoom=t,this.repaint()},Zoom.prototype.finalize=function(){this.activeZoom=this.resultantZoom},Zoom.prototype.repaint=function(){this.elem.style.transform=this.resultantZoom.css()},Zoom.prototype.reset=function(){if(this.wnd.requestAnimationFrame){this.isAnimationRunning=!0;var t=this.activeZoom,e=null,n=this,o=function(i){e||(e=i);var r=(i-e)/100;r>=1?(n.setZoom(identity),n.isAnimationRunning=!1):(n.setZoom(Transform.avg(t,identity,r)),n.wnd.requestAnimationFrame(o))};this.wnd.requestAnimationFrame(o)}else this.setZoom(identity)},Zoom.prototype.reset=Zoom.prototype.reset,"undefined"==typeof exports?window.Zoom=Zoom:exports.Zoom=Zoom;